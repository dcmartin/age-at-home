homeassistant:
  # Name of the location where Home Assistant is running
  name: Fazenda da Saudade
  # Location required to calculate the time the sun rises and sets
  latitude: 37.174956
  longitude: -121.816344
  # Impacts weather/sunrise data (altitude above sea level in meters)
  elevation: 827
  # metric for Metric, imperial for Imperial
  unit_system: imperial
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: America/Los_Angeles

http:
  api_password: !secret http_api_password
  trusted_networks: 
    - 192.168.1.0/24
    - 172.30.33.0/24
  cors_allowed_origins: 
    - https://google.com
    - https://home-assistant.io
    - http://dcmartin.com
  base_url: homeassistant.dcmartin.com:8123

updater:
  include_used_components: true

#
# BASICS
#

hassio:
discovery:
frontend:
config:
logger: !include logger.yaml

#
# PANEL IFRAME(S)
#

panel_iframe:
  docsis:
    title: 'Mikrotik'
    icon: mdi:router-wireless
    url: 'http://192.168.1.1'
  classify:
    title: 'CLASSIFY'
    icon: mdi:image-filter
    url: 'http://age-at-home.dcmartin.com/classify.html'
  digits:
    title: 'DIGITS-TX2'
    icon: mdi:format-list-numbers
    url: 'http://digits.dcmartin.com:5001'
  dima:
    title: 'DIGITS-DR'
    icon: mdi:format-list-numbers
    url: 'http://169.50.131.114:5001/'
  rpi2:
    title: 'mtn_rpi2'
    icon: mdi:image-filter-hdr
    url: 'http://192.168.1.39/dashboard'
  rpi3:
    title: 'mtn_rpi3'
    icon: mdi:image-filter-hdr
    url: 'http://192.168.1.40/dashboard'

#
# MQTT
#

mqtt:
  broker: 192.168.1.26
  keepalive: 60
  client_id: homeassistant
  # port:
  # username:
  # password:

#
# SUN
#

sun:
  elevation: 827

sensor solar:
  - platform: template
    sensors:
      solar_angle:
        value_template: '{{ states.sun.sun.attributes.elevation }}'
        friendly_name: 'Sun angle'
        unit_of_measurement: 'degrees'
      sunrise:
        value_template: '{{ strptime(states.sun.sun.attributes.next_rising,"%Y-%m-%dT%T%Z" ) | timestamp_custom("%I:%M %p") }}'
      sunset:
        value_template: '{{ strptime(states.sun.sun.attributes.next_setting,"%Y-%m-%dT%T%Z" ) | timestamp_custom("%I:%M %p") }}'
        # 2017-08-31T13:36:56+00:00

#
# FFMPEG MOTION DETECT TEST
#

ffmpeg:

binary_sensor backyardmotion:
  - platform: ffmpeg_motion
    input: !secret backyardvideo
    name: backyardmotion
    device_class: motion
    initial_state: false
    changes: 5
    # ffmpeg_bin: /usr/bin/ffmpeg
    # ffmpeg_bin: /usr/bin/avconv
    # extra_arguments: -pred 1 -q:v 2
    # reset: 20
    # repeats: 0
    # repeat_time: 0
    # extra_arguments:
# not yet (threw error)
# python_script:

# have to figure this one out
# recorder:
#   db_url: !secret my_sql_url

#
# SONOS
#

media_player sonos:
  - platform: sonos

sensor sonos_play1:
  - platform: template
    sensors:
      play1_state:
        entity_id: media_player.play1
        value_template: '{{ states.media_player.play1.state }}'
      play1_volume:
        entity_id: media_player.play1
        value_template: '{{ states.media_player.play1.attributes.volume_level }}'
      play1_volume_muted:
        entity_id: media_player.play1
        value_template: '{{ states.media_player.play1.attributes.volume_muted }}'
      play1_media_content_id:
        entity_id: media_player.play1
        value_template: '{{ states.media_player.play1.attributes.media_content_id }}'
      play1_media_content_type:
        entity_id: media_player.play1
        value_template: '{{ states.media_player.play1.attributes.media_content_type }}'
      play1_media_duration:
        entity_id: media_player.play1
        value_template: '{{ states.media_player.play1.attributes.media_duration }}'
      play1_media_title:
        entity_id: media_player.play1
        value_template: '{{ states.media_player.play1.attributes.media_title }}'
      play1_media_artist:
        entity_id: media_player.play1
        value_template: '{{ states.media_player.play1.attributes.media_artist }}'
      play1_media_album_name:
        entity_id: media_player.play1
        value_template: '{{ states.media_player.play1.attributes.media_album_name }}'

sensor sonos_play3:
  - platform: template
    sensors:
      play3_state:
        entity_id: media_player.play3
        value_template: '{{ states.media_player.play3.state }}'
      play3_volume:
        entity_id: media_player.play3
        value_template: '{{ states.media_player.play3.attributes.volume_level }}'
      play3_volume_muted:
        entity_id: media_player.play3
        value_template: '{{ states.media_player.play3.attributes.volume_muted }}'
      play3_media_content_id:
        entity_id: media_player.play3
        value_template: '{{ states.media_player.play3.attributes.media_content_id }}'
      play3_media_content_type:
        entity_id: media_player.play3
        value_template: '{{ states.media_player.play3.attributes.media_content_type }}'
      play3_media_duration:
        entity_id: media_player.play3
        value_template: '{{ states.media_player.play3.attributes.media_duration }}'
      play3_media_title:
        entity_id: media_player.play3
        value_template: '{{ states.media_player.play3.attributes.media_title }}'
      play3_media_artist:
        entity_id: media_player.play3
        value_template: '{{ states.media_player.play3.attributes.media_artist }}'
      play3_media_album_name:
        entity_id: media_player.play3
        value_template: '{{ states.media_player.play3.attributes.media_album_name }}'

sensor play1_paused:
  - platform: history_stats
    icon: mdi:speaker
    name: play1_paused
    entity_id: sensor.play1_state
    state: 'paused'
    type: ratio
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

sensor play3_paused:
  - platform: history_stats
    icon: mdi:speaker
    name: play3_paused
    entity_id: sensor.play3_state
    state: 'paused'
    type: ratio
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

# IOS

ios:
  push:
    categories:
      - name: Alarm
        identifier: 'ALARM'
        actions:
          - identifier: 'SOUND_ALARM'
            title: 'Sound Alarm'
            activationMode: 'background'
            authenticationRequired: no
            destructive: yes
            behavior: 'default'
          - identifier: 'SILENCE_ALARM'
            title: 'Silence Alarm'
            activationMode: 'foreground'
            authenticationRequired: yes
            destructive: no
            behavior: 'textInput'
            textInputButtonTitle: 'Silencio!'
            textInputPlaceholder: 'Placeholder'


# DEVICE TRACKER IN ICLOUD

device_tracker:
  - platform: icloud
    username: !secret icloud_username
    password: !secret icloud_password
    account_name: DCMARTIN

# NOTIFIERS

# targeting app on davids phone
notify ios:
  - platform: ios
    name: davids_iphone
    target: !secret notify_target

# https://home-assistant.io/components/notify.rest/
# curl -X POST -H 'Content-type: application/json' --data '{"text":"Hello, World!"}' !secret slack_webhook
#notify slack:
#  platform: rest
#  name: slack
#  resource: !secret slack_webhook
#  method: POST
#  data: "-H 'Content-type: application/json'"
#  data_template: '{{ value_json.date | timestamp_custom("%I:%M %p") }}'

# ZEROCONF -- should be automatic, but JIC

zeroconf:

# ZONES

zone jimjanaustin:
  name: jimjanaustin
  friendly_name: "Jim Jan Austin"
  latitude: 30.49788338485368
  longitude: -97.7739577124575
  radius: 200
  track_ios: true

zone nannyshouse:
  name: nannyshouse
  friendly_name: "Nannys House"
  latitude: 30.391078
  longitude: -97.694590
  radius: 200
  track_ios: true

zone austincity:
  name: austincity
  friendly_name: "Austin City"
  latitude: 30.266187
  longitude: -97.743503
  radius: 15000
  track_ios: true

zone southsanjose:
  name: southsanjose
  friendly_name: 'South San Jose'
  icon: mdi:home
  latitude: 37.242386
  longitude: -121.874724
  radius: 10000
  track_ios: true

zone chicagoland:
  name: chicagoland
  friendly_name: 'Chicago-Land'
  icon: mdi:home
  latitude: 42.013780
  longitude: -87.063821
  radius: 100000
  track_ios: true

zone westernspring:
  name: westernsprings
  friendly_name: 'Western Springs, IL'
  icon: mdi:home
  latitude: 41.811889
  longitude: -87.901608
  radius: 5000
  track_ios: true

zone magicianlake:
  name: magicianlake
  friendly_name: 'Magician Lake'
  icon: mdi:home
  latitude: 42.071890
  longitude: -86.152227
  radius: 10000
  track_ios: true

zone newzealand:
  name: newzealand
  friendly_name: 'New Zealand'
  icon: mdi:home
  latitude: -37.89431844841493
  longitude: 175.4656750337923
  radius: 10000
  track_ios: true

zone fortcollins:
  name: fortcollins
  friendly_name: 'Fort Collins, CO'
  icon: mdi:home
  latitude: 40.5786172734845
  longitude: -105.0849671207992
  radius: 10000
  track_ios: true

zone fazenda:
  name: home
  friendly_name: 'Fazenda da Saudades'
  icon: mdi:home
  latitude: 37.174815
  longitude: -121.816325
  radius: 100
  track_ios: true

# school zones

zone leland:
  name: zoneleland
  friendly_name: 'Leland High School'
  icon: mdi:school
  radius: 250
  latitude: 37.217712
  longitude: -121.844413
  track_ios: true

zone presentation:
  name: zonepresentation
  friendly_name: 'Presentation High School'
  icon: mdi:school
  radius: 250
  latitude: 37.283350
  longitude: -121.900422
  track_ios: true

# work zones

zone arc:
  name: zonearc
  friendly_name: 'IBM Almaden'
  icon: mdi:domain
  radius: 250
  latitude: 37.211072
  longitude: -121.807391
  track_ios: true

zone svl:
  name: zonesvl
  friendly_name: 'IBM Silicon Valley'
  icon: mdi:domain
  radius: 250
  latitude: 37.196352
  longitude: -121.748551
  track_ios: true

# well known locations

zone safeway:
  name: zonesafeway
  friendly_name: 'Safeway Shopping Center'
  icon: mdi:store
  radius: 100
  latitude: 37.219579
  longitude: -121.861451
  track_ios: true

# plex

media_player david_plex:
  - platform: plex
    name: david_plex
    ip_address: 192.168.1.32
    port: 32400
    token: !secret plex_token

sensor david_plex:
  - platform: plex
    host: 192.168.1.32
    port: 32400
    name: david_plex
    username: !secret plex_username
    password: !secret plex_password

# Allows you to issue voice commands from the frontend in enabled browsers
conversation:

# Enables support for tracking state changes over time.
history:
  exclude:
    domains:
      - pws
      - weather
      - updater
      - camera
      - rest
      - mqtt
      - media_player
  include:
    entities:
      - sensor.solar_angle
      - binary_sensor.keli_in_kitchen
      - binary_sensor.david_in_kitchen
      - binary_sensor.kitchen_wrong
      - sensor.david_plex
      - sensor.last_what
      - sensor.last_where
      - sensor.kitchen_what
      - sensor.bathroom_what
      - sensor.frontdoor_what
      - sensor.road_what
      - sensor.kitchen_empty_time
      - sensor.bathroom_empty_time
      - sensor.frontdoor_empty_time
      - sensor.road_empty_time
      - sensor.kitchen_busy_time
      - sensor.bathroom_busy_time
      - sensor.frontdoor_busy_time
      - sensor.road_busy_time
      - sensor.yes_activity_time
      - sensor.no_activity_time
      - sensor.play1_state
      - sensor.play3_state
      - device_tracker.dcmsiphone
      - device_tracker.kelisiphone7
      - device_tracker.ellensiphone5
      - device_tracker.halisiphone
      - device_tracker.ianmartinsiphone
      - device_tracker.rileysiphone5

# View all events in a logbook
logbook:

# Text to speech
tts:
  - platform: google

ifttt:
  key: !secret ifttt_key

#
# CAMERAS
#

camera weatherforecast:
  - platform: generic
    name: weatherforecast
    still_image_url: 'https://www.yr.no/sted/USA/California/San_Francisco/meteogram.svg'
    content_type: 'image/svg+xml'

camera wuradar:
  - platform: generic
    still_image_url: 'https://icons.wxug.com/data/weather-maps/radar/united-states/bakersfield-california-region-current-radar-animation.gif'
    name: wuradar

#
# WCV80N cameras
#

camera wcv80n_woodshed:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.163/img/video.mjpeg
    still_image_url: http://192.168.1.163/img/snapshot.cgi
    name: wcv80n_woodshed
    username: !secret wcv80n_username
    password: !secret wcv80n_password

camera wcv80n_livingroom:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.164/img/video.mjpeg
    still_image_url: http://192.168.1.164/img/snapshot.cgi
    name: wcv80n_livingroom
    username: !secret wcv80n_username
    password: !secret wcv80n_password

camera wcv80n_poolhouse_fridge:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.165/img/video.mjpeg
    still_image_url: http://192.168.1.165/img/snapshot.cgi
    name: wcv80n_poolhouse_fridge
    username: !secret wcv80n_username
    password: !secret wcv80n_password

camera wcv80n_interior_gate:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.166/img/video.mjpeg
    still_image_url: http://192.168.1.166/img/snapshot.cgi
    name: wcv80n_interior_gate
    username: !secret wcv80n_username
    password: !secret wcv80n_password

camera wcv80n_kitchen:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.167/img/video.mjpeg
    still_image_url: http://192.168.1.167/img/snapshot.cgi
    name: wcv80n_kitchen
    username: !secret wcv80n_username
    password: !secret wcv80n_password

camera wcv80n_poolhouse_exterior:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.168/img/video.mjpeg
    still_image_url: http://192.168.1.168/img/snapshot.cgi
    name: wcv80n_poolhouse_exterior
    username: !secret wcv80n_username
    password: !secret wcv80n_password

camera wcv80n_dogyard:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.169/img/video.mjpeg
    still_image_url: http://192.168.1.169/img/snapshot.cgi
    name: wcv80n_dogyard
    username: !secret wcv80n_username
    password: !secret wcv80n_password

camera wcv80n_dogshedmiddle:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.170/img/video.mjpeg
    still_image_url: http://192.168.1.170/img/snapshot.cgi
    name: wcv80n_dogshedmiddle
    username: !secret wcv80n_username
    password: !secret wcv80n_password

camera wcv80n_dogshedfront:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.172/img/video.mjpeg
    still_image_url: http://192.168.1.172/img/snapshot.cgi
    name: wcv80n_dogshedfront
    username: !secret wcv80n_username
    password: !secret wcv80n_password

camera wcv80n_dogshed_interior:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.173/img/video.mjpeg
    still_image_url: http://192.168.1.173/img/snapshot.cgi
    name: wcv80n_dogshed_interior
    username: !secret wcv80n_username
    password: !secret wcv80n_password

camera wcv80n_pondview:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.174/img/video.mjpeg
    still_image_url: http://192.168.1.174/img/snapshot.cgi
    name: wcv80n_pondview
    username: !secret wcv80n_username
    password: !secret wcv80n_password

camera wcv80n_gravelpad:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.175/img/video.mjpeg
    still_image_url: http://192.168.1.175/img/snapshot.cgi
    name: wcv80n_gravelpad
    username: !secret wcv80n_username
    password: !secret wcv80n_password

camera wcv80n_upperpath:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.176/img/video.mjpeg
    still_image_url: http://192.168.1.176/img/snapshot.cgi
    name: wcv80n_upperpath
    username: !secret wcv80n_username
    password: !secret wcv80n_password

camera wcv80n_laundry:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.177/img/video.mjpeg
    still_image_url: http://192.168.1.177/img/snapshot.cgi
    name: wcv80n_laundry
    username: !secret wcv80n_username
    password: !secret wcv80n_password

camera wcv80n_foyer:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.178/img/video.mjpeg
    still_image_url: http://192.168.1.178/img/snapshot.cgi
    name: wcv80n_foyer
    username: !secret wcv80n_username
    password: !secret wcv80n_password

camera wcv80n_frontwalk:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.179/img/video.mjpeg
    still_image_url: http://192.168.1.179/img/snapshot.cgi
    name: wcv80n_frontwalk
    username: !secret wcv80n_username
    password: !secret wcv80n_password

camera wcv80n_dogpond:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.180/img/video.mjpeg
    still_image_url: http://192.168.1.180/img/snapshot.cgi
    name: wcv80n_dogpond
    username: !secret wcv80n_username
    password: !secret wcv80n_password

camera wcv80n_poolhousestereo:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.181/img/video.mjpeg
    still_image_url: http://192.168.1.181/img/snapshot.cgi
    name: wcv80n_poolhousestereo
    username: !secret wcv80n_username
    password: !secret wcv80n_password

camera wcv80n_diningroom:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.182/img/video.mjpeg
    still_image_url: http://192.168.1.182/img/snapshot.cgi
    name: wcv80n_diningroom
    username: !secret wcv80n_username
    password: !secret wcv80n_password

camera wcv80n_backyard:
  - platform: mjpeg
    mjpeg_url: http://192.168.1.183/img/video.mjpeg
    still_image_url: http://192.168.1.183/img/snapshot.cgi
    name: wcv80n_backyard
    username: !secret wcv80n_username
    password: !secret wcv80n_password


#
# DEVICE TRACKER (NMAP)
#

device_tracker dt_nmap:
  - platform: nmap_tracker
    hosts: 192.168.1.1/24
    home_interval: 10
    track_new_devices: yes
    consider_home: 180
    exclude:
     - 192.168.1.26

sensor device_tracker_template:
  - platform: template
    sensors:
      all_devices:
        entity_id: states.device_tracker
        value_template: >
          {% for state in states.device_tracker -%}
            {%- if loop.first -%} {"devices":[
            {%- elif loop.last -%},
            {%- else -%},
            {%- endif -%} {"name":"{{state.name|lower}}","state":"{{state.state}}","attributes":"{{state.attributes}}"}
          {%- endfor -%}]}

#
# WUNDERGROUND (WEATHER UNDERGROUND)
#

sensor kcasanjo411:
  - platform: wunderground
    api_key: !secret wunderground_api_key
    pws_id: KCASANJO411
    monitored_conditions:
      - weather
      - feelslike_f
      - precip_today_in
      - relative_humidity
      - visibility_mi
      - wind_dir
      - wind_gust_mph
      - wind_mph
      - weather_1d
      - weather_1n
      - weather_2d
      - weather_2n
      - weather_3d
      - weather_3n
      - weather_4d
      - weather_4n

#
# REST PLATFORM SENSORS
#

sensor external_ip:
  - platform: rest
    resource: http://ip.jsontest.com
    name: externalip
    value_template: '{{ value_json.ip }}'

###
### HORIZON STATUS
###

sensor mtnrpi2_connectivity:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-status.cgi?ip=39'
    name: MtnRpi2 Connectivity
    value_template: '{{ value_json.connectivity | default("null") }}'

sensor mtnrpi2_exchange:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-status.cgi?ip=39'
    name: MtnRpi2 Exchange
    value_template: '{{ value_json.configuration.exchange_api | default("null") }}'

sensor mtnrpi2_balance:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-status.cgi?ip=39'
    name: MtnRpi2 Balance
    value_template: '{{ value_json.geth.eth_balance | default("null") }}'

sensor mtnrpi2_net_peer_count:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-status.cgi?ip=39'
    name: MtnRpi2 Balance
    value_template: '{{ value_json.geth.net_peer_count | default("null") }}'

sensor mtnrpi2_eth_syncing:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-status.cgi?ip=39'
    name: MtnRpi2 Eth Syncing
    value_template: '{{ value_json.geth.eth_syncing | default("null") }}'

sensor mtnrpi2_eth_blocknumber:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-status.cgi?ip=39'
    name: MtnRpi2 Eth Blocknumber
    value_template: '{{ value_json.geth.eth_block_number | default("null") }}'

# HORIZON DEVICE

sensor mtnrpi2_device_accountid:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-device.cgi?ip=39'
    name: MtnRpi2 Device AccountID
    value_template: '{{ value_json.account.id | default("null") }}'

sensor mtnrpi2_device_name:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-device.cgi?ip=39'
    name: MtnRpi2 Device Name
    value_template: '{{ value_json.name | default("null") }}'

# HORIZON SERVICE/ATTRIBUTE

sensor mtnrpi2_attribute_count:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-attribute.cgi?ip=39'
    name: MtnRpi2 Attribute Count
    value_template: '{{ value_json.attributes | length }}'

# HORIZON AGREEMENT

sensor mtnrpi2_agreements_active_count:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39'
    name: MtnRpi2 Agreements Active Count
    value_template: '{{ value_json.agreements.active | length }}'

sensor mtnrpi2_agreements_archive_count:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39'
    name: MtnRpi2 Agreements Archive Count
    value_template: '{{ value_json.agreements.archive | length }}'

# AGREEMENT #0

sensor mtnrpi2_agreement0_name:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=0'
    name: 'MtnRpi2 Agreement0 Name'
    friendly_name: 'Name'
    value_template: '{{ value_json.name | default("null") }}'

sensor mtnrpi2_agreement0_id:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=0'
    name: 'MtnRpi2 Agreement0 ID'
    friendly_name: 'AgreementID'
    value_template: '{{ value_json.current_agreement_id | default("null") }}'

sensor mtnrpi2_agreement0_protocol:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=0'
    name: MtnRpi2 Agreement0 Protocol
    friendly_name: 'Protocol'
    value_template: '{{ value_json.agreement_protocol | default("null") }}'

sensor mtnrpi2_agreement0_consumer:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=0'
    name: 'MtnRpi2 Agreement0 Consumer'
    friendly_name: 'Consumer'
    value_template: '{{ value_json.consumer_id | default("null") }}'

sensor mtnrpi2_agreement0_create:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=0'
    name: 'MtnRpi2 Agreement0 Create'
    friendly_name: 'Created'
    value_template: '{{ value_json.agreement_creation_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement0_accept:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=0'
    name: 'MtnRpi2 Agreement0 Accept'
    friendly_name: 'Accepted'
    value_template: '{{ value_json.agreement_accepted_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement0_finalize:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=0'
    name: 'MtnRpi2 Agreement0 Finalize'
    friendly_name: 'Finalized'
    value_template: '{{ value_json.agreement_finalized_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement0_receive:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=0'
    name: 'MtnRpi2 Agreement0 Receive'
    friendly_name: 'Received'
    value_template: '{{ value_json.agreement_data_received_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement0_start:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=0'
    name: 'MtnRpi2 Agreement0 Start'
    friendly_name: 'Started'
    value_template: '{{ value_json.agreement_execution_start_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

# AGREEMENT #1

sensor mtnrpi2_agreement1_name:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=1'
    name: 'MtnRpi2 Agreement1 Name'
    value_template: '{{ value_json.name | default("null") }}'

sensor mtnrpi2_agreement1_id:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=1'
    name: 'MtnRpi2 Agreement1 ID'
    value_template: '{{ value_json.current_agreement_id | default("null") }}'

sensor mtnrpi2_agreement1_protocol:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=1'
    name: MtnRpi2 Agreement1 Protocol
    value_template: '{{ value_json.agreement_protocol | default("null") }}'

sensor mtnrpi2_agreement1_consumer:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=1'
    name: 'MtnRpi2 Agreement1 Consumer'
    value_template: '{{ value_json.consumer_id | default("null") }}'

sensor mtnrpi2_agreement1_create:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=1'
    name: 'MtnRpi2 Agreement1 Create'
    value_template: '{{ value_json.agreement_creation_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement1_accept:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=1'
    name: 'MtnRpi2 Agreement1 Accept'
    value_template: '{{ value_json.agreement_accepted_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement1_finalize:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=1'
    name: 'MtnRpi2 Agreement1 Finalize'
    value_template: '{{ value_json.agreement_finalized_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement1_receive:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=1'
    name: 'MtnRpi2 Agreement1 Receive'
    value_template: '{{ value_json.agreement_data_received_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement1_start:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=1'
    name: 'MtnRpi2 Agreement1 Start'
    value_template: '{{ value_json.agreement_execution_start_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

# AGREEMENT #2

sensor mtnrpi2_agreement2_name:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=2'
    name: 'MtnRpi2 Agreement2 Name'
    value_template: '{{ value_json.name | default("null") }}'

sensor mtnrpi2_agreement2_id:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=2'
    name: 'MtnRpi2 Agreement2 ID'
    value_template: '{{ value_json.current_agreement_id | default("null") }}'

sensor mtnrpi2_agreement2_protocol:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=2'
    name: MtnRpi2 Agreement2 Protocol
    value_template: '{{ value_json.agreement_protocol | default("null") }}'

sensor mtnrpi2_agreement2_consumer:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=2'
    name: 'MtnRpi2 Agreement2 Consumer'
    value_template: '{{ value_json.consumer_id | default("null") }}'

sensor mtnrpi2_agreement2_create:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=2'
    name: 'MtnRpi2 Agreement2 Create'
    value_template: '{{ value_json.agreement_creation_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement2_accept:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=2'
    name: 'MtnRpi2 Agreement2 Accept'
    value_template: '{{ value_json.agreement_accepted_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement2_finalize:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=2'
    name: 'MtnRpi2 Agreement2 Finalize'
    value_template: '{{ value_json.agreement_finalized_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement2_receive:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=2'
    name: 'MtnRpi2 Agreement2 Receive'
    value_template: '{{ value_json.agreement_data_received_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement2_start:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=2'
    name: 'MtnRpi2 Agreement2 Start'
    value_template: '{{ value_json.agreement_execution_start_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

# AGREEMENT #3

sensor mtnrpi2_agreement3_name:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=3'
    name: 'MtnRpi2 Agreement3 Name'
    value_template: '{{ value_json.name | default("null") }}'

sensor mtnrpi2_agreement3_id:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=3'
    name: 'MtnRpi2 Agreement3 ID'
    value_template: '{{ value_json.current_agreement_id | default("null") }}'

sensor mtnrpi2_agreement3_protocol:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=3'
    name: MtnRpi2 Agreement3 Protocol
    value_template: '{{ value_json.agreement_protocol | default("null") }}'

sensor mtnrpi2_agreement3_consumer:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=3'
    name: 'MtnRpi2 Agreement3 Consumer'
    value_template: '{{ value_json.consumer_id | default("null") }}'

sensor mtnrpi2_agreement3_create:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=3'
    name: 'MtnRpi2 Agreement3 Create'
    value_template: '{{ value_json.agreement_creation_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement3_accept:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=3'
    name: 'MtnRpi2 Agreement3 Accept'
    value_template: '{{ value_json.agreement_accepted_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement3_finalize:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=3'
    name: 'MtnRpi2 Agreement3 Finalize'
    value_template: '{{ value_json.agreement_finalized_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement3_receive:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=3'
    name: 'MtnRpi2 Agreement3 Receive'
    value_template: '{{ value_json.agreement_data_received_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement3_start:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=3'
    name: 'MtnRpi2 Agreement3 Start'
    value_template: '{{ value_json.agreement_execution_start_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

# AGREEMENT #4

sensor mtnrpi2_agreement4_name:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=4'
    name: 'MtnRpi2 Agreement4 Name'
    value_template: '{{ value_json.name | default("null") }}'

sensor mtnrpi2_agreement4_id:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=4'
    name: 'MtnRpi2 Agreement4 ID'
    value_template: '{{ value_json.current_agreement_id | default("null") }}'

sensor mtnrpi2_agreement4_protocol:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=4'
    name: MtnRpi2 Agreement4 Protocol
    value_template: '{{ value_json.agreement_protocol | default("null") }}'

sensor mtnrpi2_agreement4_consumer:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=4'
    name: 'MtnRpi2 Agreement4 Consumer'
    value_template: '{{ value_json.consumer_id | default("null") }}'

sensor mtnrpi2_agreement4_create:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=4'
    name: 'MtnRpi2 Agreement4 Create'
    value_template: '{{ value_json.agreement_creation_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement4_accept:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=4'
    name: 'MtnRpi2 Agreement4 Accept'
    value_template: '{{ value_json.agreement_accepted_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement4_finalize:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=4'
    name: 'MtnRpi2 Agreement4 Finalize'
    value_template: '{{ value_json.agreement_finalized_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement4_receive:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=4'
    name: 'MtnRpi2 Agreement4 Receive'
    value_template: '{{ value_json.agreement_data_received_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi2_agreement4_start:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=4'
    name: 'MtnRpi2 Agreement4 Start'
    value_template: '{{ value_json.agreement_execution_start_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

# AGREEMENT #5

sensor mtnrpi2_agreement5:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=5'
    name: 'MtnRpi2 Agreement5'

sensor mtnrpi2_agreements:
  - platform: template
    sensors:
      agreement5_name:
        entity_id: sensor.mtnrpi2_agreement5
        value_template: '{{ states.sensor.mtnrpi2_agreement5.state["name"] }}'

sensor mtnrpi2_agreement5_name:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=5'
    name: 'MtnRpi2 Agreement5 Name'
    value_template: '{{ value_json.name | default("null") }}'
    
sensor mtnrpi2_agreement5_id:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=5'
    name: 'MtnRpi2 Agreement5 ID'
    value_template: '{{ value_json.current_agreement_id | default("null") }}'
    # value_template: '{% if value_json.error %} {{ value_json.error }} {% else %} {{ value_json.current_agreement_id }} {% endif %}'

sensor mtnrpi2_agreement5_protocol:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=5'
    name: MtnRpi2 Agreement5 Protocol
    value_template: '{{ value_json.agreement_protocol | default("null") }}'
    # value_template: '{% if value_json.error %} {{ value_json.error }} {% else %} {{ value_json.agreement_protocol }} {% endif %}'

sensor mtnrpi2_agreement5_consumer:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=5'
    name: 'MtnRpi2 Agreement5 Consumer'
    value_template: '{{ value_json.consumer_id | default("null") }}'
    # value_template: {% if value_json.error %} {{ value_json.error }} {% else %} {{ value_json.consumer_id }} {% endif %}'

sensor mtnrpi2_agreement5_create:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=5'
    name: 'MtnRpi2 Agreement5 Create'
    value_template: '{{ value_json.agreement_creation_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'
    # value_template: {% if value_json.error %} {{ value_json.error }} {% else %} {{ value_json.agreement_creation_time | timestamp_custom("%a %b %d @ %T %p") }} {% endif %}'

sensor mtnrpi2_agreement5_accept:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=5'
    name: 'MtnRpi2 Agreement5 Accept'
    value_template: '{{ value_json.agreement_accepted_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'
    # value_template: {% if value_json.error %} {{ value_json.error }} {% else %} {{ value_json.agreement_accepted_time | timestamp_custom("%a %b %d @ %T %p") }} {% endif %}'

sensor mtnrpi2_agreement5_finalize:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=5'
    name: 'MtnRpi2 Agreement5 Finalize'
    value_template: '{{ value_json.agreement_finalized_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'
    # value_template: {% if value_json.error %} {{ value_json.error }} {% else %} {{ value_json.agreement_finalized_time | timestamp_custom("%a %b %d @ %T %p") }} {% endif %}'

sensor mtnrpi2_agreement5_receive:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=5'
    name: 'MtnRpi2 Agreement5 Receive'
    value_template: '{{ value_json.agreement_data_received_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'
    # value_template: {% if value_json.error %} {{ value_json.error }} {% else %} {{ value_json.agreement_data_received_time | timestamp_custom("%a %b %d @ %T %p") }} {% endif %}'

sensor mtnrpi2_agreement5_start:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=39&id=5'
    name: 'MtnRpi2 Agreement5 Start'
    value_template: '{{ value_json.agreement_execution_start_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'
    # value_template: {% if value_json.error %} {{ value_json.error }} {% else %} {{ value_json.agreement_execution_start_time | timestamp_custom("%a %b %d @ %T %p") }} {% endif %}'

# HORIZON WORKLOAD

sensor mtnrpi2_workloads_count:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-workload.cgi?ip=39'
    name: MtnRpi2 Workloads Count
    value_template: '{{ value_json.workloads | length }}'

# HORIZON PUBLICKEY

sensor mtnrpi2_publickey:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-publickey.cgi?ip=39'
    name: MtnRpi2 Publickey
    value_template: '{{ value_json.pem | default("null") }}'

# include as above for mtnrpi3

sensor mtnrpi3_connectivity:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-status.cgi?ip=40'
    name: MtnRpi3 Connectivity
    value_template: '{{ value_json.connectivity | default("null") }}'

sensor mtnrpi3_exchange:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-status.cgi?ip=40'
    name: MtnRpi3 Exchange
    value_template: '{{ value_json.configuration.exchange_api | default("null") }}'

sensor mtnrpi3_balance:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-status.cgi?ip=40'
    name: MtnRpi3 Balance
    value_template: '{{ value_json.geth.eth_balance | default("null") }}'

sensor mtnrpi3_net_peer_count:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-status.cgi?ip=40'
    name: MtnRpi3 Balance
    value_template: '{{ value_json.geth.net_peer_count | default("null") }}'

sensor mtnrpi3_eth_syncing:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-status.cgi?ip=40'
    name: MtnRpi3 Eth Syncing
    value_template: '{{ value_json.geth.eth_syncing | default("null") }}'

sensor mtnrpi3_eth_blocknumber:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-status.cgi?ip=40'
    name: MtnRpi3 Eth Blocknumber
    value_template: '{{ value_json.geth.eth_block_number | default("null") }}'

# HORIZON DEVICE

sensor mtnrpi3_device_accountid:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-device.cgi?ip=40'
    name: MtnRpi3 Device AccountID
    value_template: '{{ value_json.account.id | default("null") }}'

sensor mtnrpi3_device_name:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-device.cgi?ip=40'
    name: MtnRpi3 Device Name
    value_template: '{{ value_json.name | default("null") }}'

# HORIZON SERVICE/ATTRIBUTE

sensor mtnrpi3_attribute_count:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-attribute.cgi?ip=40'
    name: MtnRpi3 Attribute Count
    value_template: '{{ value_json.attributes | length }}'

# HORIZON AGREEMENT

sensor mtnrpi3_agreements_active_count:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40'
    name: MtnRpi3 Agreements Active Count
    value_template: '{{ value_json.agreements.active | length }}'

sensor mtnrpi3_agreements_archive_count:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40'
    name: MtnRpi3 Agreements Archive Count
    value_template: '{{ value_json.agreements.archive | length }}'

# AGREEMENT #0

sensor mtnrpi3_agreement0_name:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=0'
    name: 'MtnRpi3 Agreement0 Name'
    value_template: '{{ value_json.name | default("null") }}'

sensor mtnrpi3_agreement0_id:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=0'
    name: 'MtnRpi3 Agreement0 ID'
    value_template: '{{ value_json.current_agreement_id | default("null") }}'

sensor mtnrpi3_agreement0_protocol:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=0'
    name: MtnRpi3 Agreement0 Protocol
    value_template: '{{ value_json.agreement_protocol | default("null") }}'

sensor mtnrpi3_agreement0_consumer:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=0'
    name: 'MtnRpi3 Agreement0 Consumer'
    value_template: '{{ value_json.consumer_id | default("null") }}'

sensor mtnrpi3_agreement0_create:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=0'
    name: 'MtnRpi3 Agreement0 Create'
    value_template: '{{ value_json.agreement_creation_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement0_accept:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=0'
    name: 'MtnRpi3 Agreement0 Accept'
    value_template: '{{ value_json.agreement_accepted_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement0_finalize:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=0'
    name: 'MtnRpi3 Agreement0 Finalize'
    value_template: '{{ value_json.agreement_finalized_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement0_receive:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=0'
    name: 'MtnRpi3 Agreement0 Receive'
    value_template: '{{ value_json.agreement_data_received_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement0_start:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=0'
    name: 'MtnRpi3 Agreement0 Start'
    value_template: '{{ value_json.agreement_execution_start_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

# AGREEMENT #1

sensor mtnrpi3_agreement1_name:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=1'
    name: 'MtnRpi3 Agreement1 Name'
    value_template: '{{ value_json.name | default("null") }}'

sensor mtnrpi3_agreement1_id:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=1'
    name: 'MtnRpi3 Agreement1 ID'
    value_template: '{{ value_json.current_agreement_id | default("null") }}'

sensor mtnrpi3_agreement1_protocol:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=1'
    name: MtnRpi3 Agreement1 Protocol
    value_template: '{{ value_json.agreement_protocol | default("null") }}'

sensor mtnrpi3_agreement1_consumer:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=1'
    name: 'MtnRpi3 Agreement1 Consumer'
    value_template: '{{ value_json.consumer_id | default("null") }}'

sensor mtnrpi3_agreement1_create:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=1'
    name: 'MtnRpi3 Agreement1 Create'
    value_template: '{{ value_json.agreement_creation_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement1_accept:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=1'
    name: 'MtnRpi3 Agreement1 Accept'
    value_template: '{{ value_json.agreement_accepted_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement1_finalize:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=1'
    name: 'MtnRpi3 Agreement1 Finalize'
    value_template: '{{ value_json.agreement_finalized_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement1_receive:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=1'
    name: 'MtnRpi3 Agreement1 Receive'
    value_template: '{{ value_json.agreement_data_received_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement1_start:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=1'
    name: 'MtnRpi3 Agreement1 Start'
    value_template: '{{ value_json.agreement_execution_start_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

# AGREEMENT #2

sensor mtnrpi3_agreement2_name:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=2'
    name: 'MtnRpi3 Agreement2 Name'
    value_template: '{{ value_json.name | default("null") }}'

sensor mtnrpi3_agreement2_id:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=2'
    name: 'MtnRpi3 Agreement2 ID'
    value_template: '{{ value_json.current_agreement_id | default("null") }}'

sensor mtnrpi3_agreement2_protocol:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=2'
    name: MtnRpi3 Agreement2 Protocol
    value_template: '{{ value_json.agreement_protocol | default("null") }}'

sensor mtnrpi3_agreement2_consumer:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=2'
    name: 'MtnRpi3 Agreement2 Consumer'
    value_template: '{{ value_json.consumer_id | default("null") }}'

sensor mtnrpi3_agreement2_create:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=2'
    name: 'MtnRpi3 Agreement2 Create'
    value_template: '{{ value_json.agreement_creation_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement2_accept:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=2'
    name: 'MtnRpi3 Agreement2 Accept'
    value_template: '{{ value_json.agreement_accepted_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement2_finalize:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=2'
    name: 'MtnRpi3 Agreement2 Finalize'
    value_template: '{{ value_json.agreement_finalized_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement2_receive:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=2'
    name: 'MtnRpi3 Agreement2 Receive'
    value_template: '{{ value_json.agreement_data_received_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement2_start:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=2'
    name: 'MtnRpi3 Agreement2 Start'
    value_template: '{{ value_json.agreement_execution_start_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

# AGREEMENT #3

sensor mtnrpi3_agreement3_name:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=3'
    name: 'MtnRpi3 Agreement3 Name'
    value_template: '{{ value_json.name | default("null") }}'

sensor mtnrpi3_agreement3_id:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=3'
    name: 'MtnRpi3 Agreement3 ID'
    value_template: '{{ value_json.current_agreement_id | default("null") }}'

sensor mtnrpi3_agreement3_protocol:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=3'
    name: MtnRpi3 Agreement3 Protocol
    value_template: '{{ value_json.agreement_protocol | default("null") }}'

sensor mtnrpi3_agreement3_consumer:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=3'
    name: 'MtnRpi3 Agreement3 Consumer'
    value_template: '{{ value_json.consumer_id | default("null") }}'

sensor mtnrpi3_agreement3_create:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=3'
    name: 'MtnRpi3 Agreement3 Create'
    value_template: '{{ value_json.agreement_creation_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement3_accept:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=3'
    name: 'MtnRpi3 Agreement3 Accept'
    value_template: '{{ value_json.agreement_accepted_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement3_finalize:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=3'
    name: 'MtnRpi3 Agreement3 Finalize'
    value_template: '{{ value_json.agreement_finalized_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement3_receive:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=3'
    name: 'MtnRpi3 Agreement3 Receive'
    value_template: '{{ value_json.agreement_data_received_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement3_start:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=3'
    name: 'MtnRpi3 Agreement3 Start'
    value_template: '{{ value_json.agreement_execution_start_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

# AGREEMENT #4

sensor mtnrpi3_agreement4_name:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=4'
    name: 'MtnRpi3 Agreement4 Name'
    value_template: '{{ value_json.name | default("null") }}'

sensor mtnrpi3_agreement4_id:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=4'
    name: 'MtnRpi3 Agreement4 ID'
    value_template: '{{ value_json.current_agreement_id | default("null") }}'

sensor mtnrpi3_agreement4_protocol:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=4'
    name: MtnRpi3 Agreement4 Protocol
    value_template: '{{ value_json.agreement_protocol | default("null") }}'

sensor mtnrpi3_agreement4_consumer:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=4'
    name: 'MtnRpi3 Agreement4 Consumer'
    value_template: '{{ value_json.consumer_id | default("null") }}'

sensor mtnrpi3_agreement4_create:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=4'
    name: 'MtnRpi3 Agreement4 Create'
    value_template: '{{ value_json.agreement_creation_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement4_accept:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=4'
    name: 'MtnRpi3 Agreement4 Accept'
    value_template: '{{ value_json.agreement_accepted_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement4_finalize:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=4'
    name: 'MtnRpi3 Agreement4 Finalize'
    value_template: '{{ value_json.agreement_finalized_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement4_receive:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=4'
    name: 'MtnRpi3 Agreement4 Receive'
    value_template: '{{ value_json.agreement_data_received_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement4_start:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=4'
    name: 'MtnRpi3 Agreement4 Start'
    value_template: '{{ value_json.agreement_execution_start_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

# AGREEMENT #5

sensor mtnrpi3_agreement5_name:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=5'
    name: 'MtnRpi3 Agreement5 Name'
    value_template: '{{ value_json.name | default("null") }}'

sensor mtnrpi3_agreement5_id:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=5'
    name: 'MtnRpi3 Agreement5 ID'
    value_template: '{{ value_json.current_agreement_id | default("null") }}'

sensor mtnrpi3_agreement5_protocol:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=5'
    name: MtnRpi3 Agreement5 Protocol
    value_template: '{{ value_json.agreement_protocol | default("null") }}'

sensor mtnrpi3_agreement5_consumer:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=5'
    name: 'MtnRpi3 Agreement5 Consumer'
    value_template: '{{ value_json.consumer_id | default("null") }}'

sensor mtnrpi3_agreement5_create:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=5'
    name: 'MtnRpi3 Agreement5 Create'
    value_template: '{{ value_json.agreement_creation_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement5_accept:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=5'
    name: 'MtnRpi3 Agreement5 Accept'
    value_template: '{{ value_json.agreement_accepted_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement5_finalize:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=5'
    name: 'MtnRpi3 Agreement5 Finalize'
    value_template: '{{ value_json.agreement_finalized_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement5_receive:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=5'
    name: 'MtnRpi3 Agreement5 Receive'
    value_template: '{{ value_json.agreement_data_received_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

sensor mtnrpi3_agreement5_start:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-agreement.cgi?ip=40&id=5'
    name: 'MtnRpi3 Agreement5 Start'
    value_template: '{{ value_json.agreement_execution_start_time | timestamp_custom("%a %b %d @ %I:%M %p") }}'

# HORIZON WORKLOAD

sensor mtnrpi3_workloads_count:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-workload.cgi?ip=40'
    name: MtnRpi3 Workloads Count
    value_template: '{{ value_json.workloads | length }}'

# HORIZON PUBLICKEY

sensor mtnrpi3_publickey:
  - platform: rest
    resource: 'http://192.168.1.32/CGI/mtn-publickey.cgi?ip=40'
    name: MtnRpi3 Publickey
    value_template: '{{ value_json.pem | default("null") }}'

###
### AGE-AT-HOME
###

camera last_image:
  - platform: mqtt
    name: last_image
    topic: 'image/+'

camera last_image_annotated:
  - platform: mqtt
    name: last_image_annotated
    topic: 'image-annotated/+'

camera last_image_cropped:
  - platform: mqtt
    name: last_image_cropped
    icon: mdi:image
    topic: 'image-cropped/+'

sensor last_ago:
  - platform: mqtt
    name: last_ago
    unit_of_measurement: seconds
    state_topic: 'presence/+'
    value_template: '{{ (now().timestamp() | int) - value_json.date }}'

sensor last_how:
  - platform: mqtt
    icon: mdi:numeric
    state_topic: 'presence/+'
    name: last_how
    expire_after: 30 # seconds
    value_template: '{{ value_json.score }}'

sensor last_where:
  - platform: mqtt
    icon: mdi:house
    state_topic: 'presence/+'
    expire_after: 30 # seconds
    name: last_where
    value_template: '{{ value_json.location }}'

sensor last_what:
  - platform: mqtt
    icon: mdi:human
    state_topic: 'presence/+'
    name: last_what
    expire_after: 30 # seconds
    value_template: '{{ value_json.class }}'

sensor last_who:
  - platform: mqtt
    icon: mdi:comment-question-outline
    state_topic: 'presence/+'
    name: last_who
    expire_after: 30 # seconds
    value_template: '{{ value_json.model }}'

sensor last_when:
  - platform: mqtt
    icon: mdi:clock
    state_topic: 'presence/+'
    name: last_when
    value_template: '{{ value_json.date | timestamp_custom("%a %b %d @ %I:%M %p") }}'

##
## KITCHEN
##

camera kitchen_camera:
  - platform: mjpeg
    name: kitchen_camera
    mjpeg_url: http://192.168.1.34:8081/

sensor presence_kitchen:
  - platform: mqtt
    name: presence_kitchen
    icon: mdi:human
    state_topic: 'presence/kitchen'

sensor kitchen_what:
  - platform: mqtt
    name: kitchen_what
    icon: mdi:human-greeting
    state_topic: 'presence/kitchen'
    value_template: '{{ value_json.class | default("nothing") }}'

sensor kitchen_who:
  - platform: mqtt
    name: kitchen_who
    icon: mdi:human-greeting
    state_topic: 'presence/kitchen'
    value_template: '{{ value_json.model | default("none") }}'

sensor kitchen_why:
  - platform: mqtt
    name: kitchen_why
    icon: mdi:human-greeting
    state_topic: 'presence/kitchen'
    value_template: '{{ value_json.score | default(0.0) }}'

sensor kitchen_when:
  - platform: mqtt
    name: kitchen_when
    icon: mdi:human-greeting
    state_topic: 'presence/kitchen'
    value_template: '{{ value_json.date | timestamp_custom("%I:%M %p") }}'

sensor kitchen_ago:
  - platform: mqtt
    name: kitchen_ago
    unit_of_measurement: seconds
    state_topic: 'presence/kitchen'
    value_template: '{{ (now().timestamp() | int) - value_json.date }}'

camera kitchen_image:
  - platform: mqtt
    name: kitchen_image
    topic: 'image/kitchen'

camera kitchen_image_annotated:
  - platform: mqtt
    name: kitchen_image_annotated
    topic: 'image-annotated/kitchen'

camera kitchen_image_cropped:
  - platform: mqtt
    name: kitchen_image_cropped
    icon: mdi:image
    topic: 'image-cropped/kitchen'

sensor kitchen_empty_time:
  - platform: history_stats
    icon: mdi:timer
    name: kitchen_empty_time
    entity_id: sensor.kitchen_what
    state: 'unknown'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

# TEMPLATE sensors - why no work?

sensor kitchen_json:
  - platform: template
    sensors:
      kitchen_presence:
        entity_id: sensor.presence_kitchen
        value_template: '{{ states.sensor.presence_kitchen.state }}'

sensor kitchen_attributes:
  - platform: template
    sensors:
      kitchen_date:
        entity_id: sensor.kitchen_presence
        value_template: '{{ states.sensor.kitchen_presence.state.date | timestamp_custom("%I:%M %p") }}'
      kitchen_class:
        entity_id: sensor.kitchen_presence
        value_template: '{{ states.sensor.kitchen_presence.state.class }}'
      kitchen_model:
        entity_id: sensor.kitchen_presence
        value_template: '{{ states.sensor.kitchen_presence.state.model }}'
      kitchen_score:
        entity_id: sensor.kitchen_presence
        value_template: '{{ states.sensor.kitchen_presence.state.score }}'

##
## BATHROOM
##

camera bathroom_camera:
  - platform: mjpeg
    name: bathroom_camera
    mjpeg_url: http://192.168.1.35:8081/

sensor presence_bathroom:
  - platform: mqtt
    name: presence_bathroom
    state_topic: 'presence/bathroom'

sensor bathroom_what:
  - platform: mqtt
    name: bathroom_what
    state_topic: 'presence/bathroom'
    value_template: '{{ value_json.class | default("nothing") }}'

sensor bathroom_who:
  - platform: mqtt
    name: bathroom_who
    state_topic: 'presence/bathroom'
    value_template: '{{ value_json.model | default("none") }}'

sensor bathroom_why:
  - platform: mqtt
    name: bathroom_why
    state_topic: 'presence/bathroom'
    value_template: '{{ value_json.score | default(0.0) }}'

sensor bathroom_when:
  - platform: mqtt
    name: bathroom_when
    state_topic: 'presence/bathroom'
    value_template: '{{ value_json.date | timestamp_custom("%I:%M %p") }}'

sensor bathroom_ago:
  - platform: mqtt
    name: bathroom_ago
    unit_of_measurement: seconds
    state_topic: 'presence/bathroom'
    value_template: '{{ (now().timestamp() | int) - value_json.date }}'

camera bathroom_image:
  - platform: mqtt
    name: bathroom_image
    topic: 'image/bathroom'

camera bathroom_image_annotated:
  - platform: mqtt
    name: bathroom_image_annotated
    topic: 'image-annotated/bathroom'

camera bathroom_image_cropped:
  - platform: mqtt
    name: bathroom_image_cropped
    topic: 'image-cropped/bathroom'

sensor bathroom_empty_time:
  - platform: history_stats
    icon: mdi:timer
    name: bathroom_empty_time
    entity_id: sensor.bathroom_what
    state: 'unknown'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

##
## ROAD
##

camera road_camera:
  - platform: mjpeg
    name: road_camera
    mjpeg_url: http://192.168.1.36:8081/

sensor presence_road:
  - platform: mqtt
    name: presence_road
    icon: mdi:human
    state_topic: 'presence/road'

sensor road_what:
  - platform: mqtt
    name: road_what
    icon: mdi:human-greeting
    state_topic: 'presence/road'
    value_template: '{{ value_json.class | default("nothing") }}'

sensor road_who:
  - platform: mqtt
    name: road_who
    icon: mdi:human-greeting
    state_topic: 'presence/road'
    value_template: '{{ value_json.model | default("none") }}'

sensor road_why:
  - platform: mqtt
    name: road_why
    icon: mdi:human-greeting
    state_topic: 'presence/road'
    value_template: '{{ value_json.score | default(0.0) }}'

sensor road_when:
  - platform: mqtt
    name: road_when
    icon: mdi:human-greeting
    state_topic: 'presence/road'
    value_template: '{{ value_json.date | timestamp_custom("%I:%M %p") }}'

sensor road_ago:
  - platform: mqtt
    name: road_ago
    unit_of_measurement: seconds
    state_topic: 'presence/road'
    value_template: '{{ (now().timestamp() | int) - value_json.date }}'

camera road_image:
  - platform: mqtt
    name: road_image
    icon: mdi:image
    topic: 'image/road'

camera road_image_annotated:
  - platform: mqtt
    name: road_image_annotated
    topic: 'image-annotated/road'

camera road_image_cropped:
  - platform: mqtt
    name: road_image_cropped
    topic: 'image-cropped/road'

sensor road_empty_time:
  - platform: history_stats
    icon: mdi:timer
    name: road_empty_time
    entity_id: sensor.road_what
    state: 'unknown'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'
 
##
## FRONTDOOR
##

camera frontdoor_camera:   
  - platform: mjpeg
    name: frontdoor_camera
    mjpeg_url: http://192.168.1.37:8081/

sensor presence_frontdoor:
  - platform: mqtt
    name: presence_frontdoor
    icon: mdi:human
    state_topic: 'presence/frontdoor'

sensor frontdoor_what:
  - platform: mqtt
    name: frontdoor_what
    icon: mdi:human-greeting
    state_topic: 'presence/frontdoor'
    value_template: '{{ value_json.class | default("nothing") }}'

sensor frontdoor_who:
  - platform: mqtt
    name: frontdoor_who
    icon: mdi:human-greeting
    state_topic: 'presence/frontdoor'
    value_template: '{{ value_json.model | default("none") }}'

sensor frontdoor_why:
  - platform: mqtt
    name: frontdoor_why
    icon: mdi:human-greeting
    state_topic: 'presence/frontdoor'
    value_template: '{{ value_json.score | default(0.0) }}'

sensor frontdoor_when:
  - platform: mqtt
    name: frontdoor_when
    icon: mdi:human-greeting
    state_topic: 'presence/frontdoor'
    value_template: '{{ value_json.date | timestamp_custom("%I:%M %p") }}'

sensor frontdoor_ago:
  - platform: mqtt
    name: frontdoor_ago
    unit_of_measurement: seconds
    state_topic: 'presence/frontdoor'
    value_template: '{{ (now().timestamp() | int) - value_json.date }}'

camera frontdoor_image:
  - platform: mqtt
    name: frontdoor_image
    icon: mdi:image
    topic: 'image/frontdoor'

camera frontdoor_image_annotated:
  - platform: mqtt
    name: frontdoor_image_annotated
    icon: mdi:image
    topic: 'image-annotated/frontdoor'

camera frontdoor_image_cropped:
  - platform: mqtt
    name: frontdoor_image_cropped
    icon: mdi:image
    topic: 'image-cropped/frontdoor'

sensor frontdoor_empty_time:
  - platform: history_stats
    icon: mdi:timer
    name: frontdoor_empty_time
    entity_id: sensor.frontdoor_what
    state: 'unknown'
    type: time
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

#
# PRESENCE
#

sensor kitchen_busy_time:
  - platform: history_stats
    icon: mdi:timer
    name: kitchen_busy_time
    entity_id: binary_sensor.people_in_kitchen
    state: 'on'
    type: ratio
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

sensor yes_activity_time:
  - platform: history_stats
    icon: mdi:timer
    name: yes_activity_time
    entity_id: binary_sensor.yes_activity
    state: 'on'
    type: ratio
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

sensor no_activity_time:
  - platform: history_stats
    icon: mdi:timer
    name: no_activity_time
    entity_id: binary_sensor.no_activity
    state: 'on'
    type: ratio
    start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
    end: '{{ now() }}'

binary_sensor noactivity:
  - platform: template
    name: noactivity
    sensors:
      yes_activity:
        entity_id:
          - sensor.last_what
        value_template: >
          {{
              states.sensor.last_what.state != 'unknown'
          }}
      no_activity:
        entity_id:
          - sensor.last_what
        value_template: >
          {{
              states.sensor.last_what.state == 'unknown'
          }}

binary_sensor peopleinkitchen:
  - platform: template
    name: peopleinkitchen
    sensors:
      people_in_kitchen:
        entity_id:
          - sensor.kitchen_what
        value_template: >
          {{
              states.sensor.kitchen_what.state == 'david'
            or
              states.sensor.kitchen_what.state == 'keli'
            or
              states.sensor.kitchen_what.state == 'hali'
            or
              states.sensor.kitchen_what.state == 'ian'
            or
              states.sensor.kitchen_what.state == 'riley'
            or
              states.sensor.kitchen_what.state == 'ellen'
          }}

binary_sensor kitchen_validate:
  - platform: template
    sensors:
      kitchen_wrong:
        entity_id:
          - sensor.kitchen_what
          - device_tracker.ellensiphone5
          - device_tracker.davids_iphone
          - device_tracker.rileysiphone5
          - device_tracker.ianmartinsiphone
          - device_tracker.halisiphone
        value_template: >
          {{
            ( states.device_tracker.davids_iphone.state != 'home' and states.sensor.kitchen_what.state == 'david' )
            or
            ( states.device_tracker.kelis_iphone.state != 'home' and states.sensor.kitchen_what.state == 'keli' )
            or
            ( states.device_tracker.halisiphone.state != 'home' and states.sensor.kitchen_what.state == 'hali' )
            or
            ( states.device_tracker.ianmartinsiphone.state != 'home' and states.sensor.kitchen_what.state == 'ian' )
            or
            ( states.device_tracker.rileysiphone5.state != 'home' and states.sensor.kitchen_what.state == 'riley' )
            or
            ( states.device_tracker.ellensiphone5.state != 'home' and states.sensor.kitchen_what.state == 'ellen' )
          }}

binary_sensor kitchen_test:
  - platform: template
    sensors:
      david_in_kitchen:
        entity_id:
          - sensor.kitchen_what
          - device_tracker.davids_iphone
        value_template: >
          {{
            states.device_tracker.davids_iphone.state == 'home' and
            states.sensor.kitchen_what.state == 'david'
          }}
      keli_in_kitchen:
        friendly_name: keli in kitchen
        entity_id:
          - sensor.kitchen_what
          - device_tracker.kelis_iphone
        value_template: >
          {{
            states.device_tracker.kelis_iphone.state == 'home' and
            states.sensor.kitchen_what.state == 'keli'
          }}

# INCLUDE STUFF

group: !include groups.yaml

automation: !include automations.yaml
